{% extends 'core/base.html' %} {% block content %}

<!-- ğŸ¨ Inject styles via JavaScript -->
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const style = document.createElement("style");
        style.innerHTML = `
        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(to right, #e0f7fa, #f1f8e9);
            color: #333;
        }

        main {
            max-width: 800px;
            margin: auto;
            padding: 30px;
            background-color: #ffffffdd;
            border-radius: 12px;
            box-shadow: 0 0 12px rgba(0,0,0,0.05);
            animation: fadeIn 0.6s ease-in-out;
        }

        form {
            display: flex;
            flex-direction: column;
        }

        form label {
            font-weight: bold;
            margin-top: 10px;
        }

        form input,
        form textarea,
        form select {
            padding: 10px;
            margin-top: 5px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 6px;
        }

        form button {
            background-color: #00796b;
            color: white;
            padding: 10px 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 15px;
        }

        form button:hover {
            background-color: #004d40;
        }

        button.toggle-btn {
            background-color: #009688;
            color: white;
            padding: 10px 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 15px;
            font-size: 15px;
        }

        button.toggle-btn:hover {
            background-color: #00796b;
        }

        ul.visit-list {
            list-style-type: none;
            padding-left: 0;
        }

        ul.visit-list li {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background-color: #f9f9f9;
            box-shadow: 0 2px 6px rgba(0,0,0,0.03);
        }

        ul.visit-list li a {
            color: #00796b;
            text-decoration: none;
            font-weight: bold;
        }

        ul.visit-list li a:hover {
            text-decoration: underline;
        }

        button.view-btn,
        button.clear-btn {
            margin-left: 10px;
            background-color: #eeeeee;
            border: 1px solid #ccc;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        button.view-btn:hover,
        button.clear-btn:hover {
            background-color: #ddd;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    `;
        document.head.appendChild(style);
    });
</script>

<main>
    <h2 style="text-align: center;">ğŸ©º Visit Details</h2>

    {% if user.role == 'patient' %}
    <button class="toggle-btn" onclick="document.getElementById('addForm').style.display='block'">â• Add Details</button>
    <div id="addForm" style="display:none;">
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <label for="id_visit_date">ğŸ“… Visit Date:</label> {{ form.visit_date }}

            <label for="id_hospital_name">ğŸ¥ Hospital Name:</label> {{ form.hospital_name }}

            <label for="id_doctor_name">ğŸ‘¨â€âš•ï¸ Doctor Name:</label> {{ form.doctor_name }}

            <label for="id_report_file">ğŸ§ª Upload Report (Blood Test/Scan):</label> {{ form.report_file }}
            <button type="button" class="view-btn" onclick="viewFile('id_report_file')">ğŸ‘ï¸ View</button>
            <button type="button" class="clear-btn" onclick="clearFile('id_report_file')">ğŸ—‘ï¸ Delete</button>

            <label for="id_prescription_file">ğŸ’Š Upload Prescription:</label> {{ form.prescription_file }}
            <button type="button" class="view-btn" onclick="viewFile('id_prescription_file')">ğŸ‘ï¸ View</button>
            <button type="button" class="clear-btn" onclick="clearFile('id_prescription_file')">ğŸ—‘ï¸ Delete</button>

            <label for="id_medicine_details">ğŸ“ Medicine Details:</label> {{ form.medicine_details }}

            <button type="submit">âœ… Submit</button>
        </form>
    </div>
    {% endif %}

    <hr>
    <h3>ğŸ“‚ Submitted Records</h3>
    <ul class="visit-list">
        {% for visit in visits %}
        <li>
            <strong>ğŸ“… Date:</strong> {{ visit.visit_date }}<br>
            <strong>ğŸ¥ Hospital:</strong> {{ visit.hospital_name }}<br>
            <strong>ğŸ‘¨â€âš•ï¸ Doctor:</strong> {{ visit.doctor_name }}<br> {% if visit.report_file %}
            <strong>ğŸ§ª Report:</strong> <a href="{{ visit.report_file.url }}" target="_blank">ğŸ“ View Report</a><br> {% endif %} {% if visit.prescription_file %}
            <strong>ğŸ’Š Prescription:</strong> <a href="{{ visit.prescription_file.url }}" target="_blank">ğŸ“ View Prescription</a><br> {% endif %}

            <strong>ğŸ“ Medicines:</strong> {{ visit.medicine_details }}<br> {% if user.role == 'therapist' %}
            <br>
            <a href="{% url 'edit_visit' visit.id %}">âœï¸ Edit</a> |
            <a href="{% url 'delete_visit' visit.id %}">ğŸ—‘ï¸ Delete</a> {% endif %}
        </li>
        {% empty %}
        <p>No visit records found.</p>
        {% endfor %}
    </ul>
</main>

<script>
    function viewFile(inputId) {
        const input = document.getElementById(inputId);
        if (input.files.length > 0) {
            const file = input.files[0];
            const url = URL.createObjectURL(file);
            window.open(url, '_blank');
        } else {
            alert("No file selected.");
        }
    }

    function clearFile(inputId) {
        const input = document.getElementById(inputId);
        input.value = "";
    }
</script>

{% endblock %}